<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cinema Tech | Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø®Ø§ØµØ© Ø¨Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        .search-section {
            padding: 20px;
            background: linear-gradient(to bottom, #000, var(--bg-dark));
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center;
        }

        .filter-bar {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            width: 100%;
            padding: 10px 0;
            scrollbar-width: none; /* Ø¥Ø®ÙØ§Ø¡ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
        }

        .filter-btn {
            background: #222;
            color: white;
            border: 1px solid #444;
            padding: 8px 20px;
            border-radius: 20px;
            white-space: nowrap;
            cursor: pointer;
            transition: 0.3s;
        }

        .filter-btn.active {
            background: var(--primary);
            border-color: var(--primary);
        }

        .user-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .login-link {
            color: white;
            text-decoration: none;
            font-weight: bold;
            background: var(--primary);
            padding: 5px 15px;
            border-radius: 5px;
            font-size: 14px;
        }
    </style>
</head>
<body>

    <header>
        <div class="nav-container" style="display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto;">
            <h1 onclick="location.href='index.html'" style="cursor:pointer; margin: 0;">
                Cinema <span style="color:var(--primary)">Tech</span>
            </h1>

            <div class="user-actions">
                <div class="notif-wrapper">
                    <div id="notif-bell" onclick="toggleNotifs()" style="font-size: 20px; position: relative;">
                        ğŸ”” <span id="notif-badge" class="badge">0</span>
                    </div>
                    <div id="notif-dropdown" class="notif-content">
                        <h4>Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</h4>
                        <div id="notif-items">
                            <p style="padding:10px; font-size:12px; color:#888;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</p>
                        </div>
                    </div>
                </div>

                <div id="auth-zone">
                    <a href="login.html" class="login-link">Ø¯Ø®ÙˆÙ„</a>
                </div>
            </div>
        </div>
    </header>

    <section class="search-section">
        <div style="position: relative; width: 100%; max-width: 600px;">
            <input type="text" id="search" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³Ù„Ø³Ù„ Ø£Ùˆ ÙÙŠÙ„Ù…..." onkeyup="searchShows()" 
                   style="width: 100%; padding: 15px 20px; border-radius: 30px; border: none; background: #222; color: white; outline: none;">
        </div>

        <div class="filter-bar">
            <button class="filter-btn active" onclick="filterType('all', this)">Ø§Ù„ÙƒÙ„</button>
            <button class="filter-btn" onclick="filterType('series', this)">Ù…Ø³Ù„Ø³Ù„Ø§Øª</button>
            <button class="filter-btn" onclick="filterType('movies', this)">Ø£ÙÙ„Ø§Ù…</button>
            <button class="filter-btn" onclick="filterType('top', this)">Ø§Ù„Ø£Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…Ø§Ù‹</button>
        </div>
    </section>

    <main class="container">
        <div class="grid" id="main-grid">
            <div class="loader" style="grid-column: 1/-1; text-align: center; padding: 50px;">
                Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±ÙˆØ§Ø¦Ø¹...
            </div>
        </div>
    </main>

    <footer style="text-align: center; padding: 40px 20px; color: #666; font-size: 14px; border-top: 1px solid #222; margin-top: 50px;">
        <p>&copy; 2026 Cinema Tech. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p>
        <p>ØªÙ… Ø§Ù„ØªØ·ÙˆÙŠØ± Ù„ØªÙ‚Ø¯ÙŠÙ… Ø£ÙØ¶Ù„ ØªØ¬Ø±Ø¨Ø© Ù…Ø´Ø§Ù‡Ø¯Ø© Ø¹Ø¨Ø± ØªÙ„ÙŠØ¬Ø±Ø§Ù….</p>
    </footer>

    <script src="script.js"></script>
    <script>
        // ÙƒÙˆØ¯ Ø¥Ø¶Ø§ÙÙŠ Ø®Ø§Øµ Ø¨Ù€ index.html Ù„ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        document.addEventListener('DOMContentLoaded', () => {
            const role = localStorage.getItem('role');
            const authZone = document.getElementById('auth-zone');
            
            if (role === 'admin') {
                authZone.innerHTML = `<a href="admin.html" class="login-link" style="background:#28a745">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>`;
            } else if (role === 'user') {
                authZone.innerHTML = `<span style="font-size:14px">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ</span>`;
            }
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³Ù„Ø³Ù„Ø§Øª ÙÙˆØ± ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
            loadMainLibrary();
        });

        async function loadMainLibrary() {
            try {
                const res = await fetch('/api/series');
                const shows = await res.json();
                const grid = document.getElementById('main-grid');
                
                if (shows.length === 0) {
                    grid.innerHTML = `<p style="grid-column: 1/-1; text-align: center;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰ Ù…ØªØ§Ø­ Ø­Ø§Ù„ÙŠØ§Ù‹.</p>`;
                    return;
                }

                grid.innerHTML = shows.map(show => `
                    <div class="show-card fade-in" onclick="location.href='watch.html?id=${show._id}'">
                        <div class="poster-container">
                            <img src="${show.poster}" alt="${show.title}" loading="lazy">
                            <div class="rating-badge">â­ ${show.rating || '0'}</div>
                        </div>
                        <div class="show-info">
                            <h3>${show.title}</h3>
                            <p>${show.episodes ? show.episodes.length : 0} Ø­Ù„Ù‚Ø©</p>
                        </div>
                    </div>
                `).join('');
            } catch (err) {
                console.error("ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„:", err);
            }
        }

        function filterType(type, btn) {
            // ØªØ­Ø¯ÙŠØ« Ø´ÙƒÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            // Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØµÙÙŠØ© (ÙŠÙ…ÙƒÙ†Ùƒ ØªÙˆØ³ÙŠØ¹Ù‡ Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹ Ù‡Ù†Ø§)
            searchShows(); 
        }

        function searchShows() {
            const query = document.getElementById('search').value.toLowerCase();
            const cards = document.querySelectorAll('.show-card');
            
            cards.forEach(card => {
                const title = card.querySelector('h3').innerText.toLowerCase();
                if (title.includes(query)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }
    </script>
</body>
</html>