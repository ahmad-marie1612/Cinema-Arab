<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Cinema Tech</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .admin-box { background: #1f1f1f; padding: 20px; border-radius: 10px; margin: 20px auto; max-width: 800px; }
        .episode-block { background: #2a2a2a; padding: 15px; margin: 10px 0; border-radius: 8px; border: 1px solid #444; }
        .source-block { display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap; }
        .source-block input { flex: 1; min-width: 120px; margin: 0; }
        .btn-small { padding: 5px 10px; background: #333; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .btn-add { background: #e50914; margin-top: 15px; width: 100%; padding: 10px; color: white; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <header>
        <h1 onclick="location.href='index.html'" style="cursor:pointer">Ù„ÙˆØ­Ø© <span style="color:#e50914">Ø§Ù„ØªØ­ÙƒÙ…</span></h1>
    </header>

    <div class="admin-box">
        <h2>Ø¥Ø¶Ø§ÙØ© Ù…Ø³Ù„Ø³Ù„ / ÙÙŠÙ„Ù… Ø¬Ø¯ÙŠØ¯</h2>
        <input type="text" id="title" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ù„Ø³Ù„">
        <textarea id="desc" placeholder="Ù‚ØµØ© Ø§Ù„Ù…Ø³Ù„Ø³Ù„"></textarea>
        <input type="text" id="poster" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ø¨ÙˆØ³ØªØ±">
        
        <div id="episodes-container">
            </div>
        
        <button class="btn-small" onclick="addEpisodeBlock()" style="background:#28a745; margin-top:10px;">+ Ø¥Ø¶Ø§ÙØ© Ø­Ù„Ù‚Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
        <button class="btn-add" onclick="saveSeries()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¹Ù…Ù„ ÙˆÙ†Ø´Ø±Ù‡</button>
    </div>

    <script>
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
        if(localStorage.getItem('role') !== 'admin') {
            alert('ØºÙŠØ± Ù…ØµØ±Ø­ Ù„Ùƒ Ø¨Ø§Ù„Ø¯Ø®ÙˆÙ„');
            location.href = 'index.html';
        }

        let epCount = 0;

        function addEpisodeBlock() {
            const container = document.getElementById('episodes-container');
            const epDiv = document.createElement('div');
            epDiv.className = 'episode-block';
            epDiv.id = `ep-${epCount}`;
            
            epDiv.innerHTML = `
                <input type="text" class="ep-title" placeholder="Ø§Ø³Ù… Ø§Ù„Ø­Ù„Ù‚Ø© (Ù…Ø«Ø§Ù„: Ø§Ù„Ø­Ù„Ù‚Ø© 1)">
                <div class="sources-container"></div>
                <button class="btn-small" onclick="addSourceBlock(${epCount})" style="background:#007bff; margin-top:10px;">+ Ø¥Ø¶Ø§ÙØ© Ø¬ÙˆØ¯Ø© ÙˆØ±Ø§Ø¨Ø· ØªÙ„ÙŠØ¬Ø±Ø§Ù…</button>
            `;
            container.appendChild(epDiv);
            addSourceBlock(epCount); // Ø¥Ø¶Ø§ÙØ© Ø¬ÙˆØ¯Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ÙØ§Ø±ØºØ©
            epCount++;
        }

        function addSourceBlock(epId) {
            const sourcesContainer = document.querySelector(`#ep-${epId} .sources-container`);
            const srcDiv = document.createElement('div');
            srcDiv.className = 'source-block';
            srcDiv.innerHTML = `
                <input type="text" class="src-quality" placeholder="Ø§Ù„Ø¬ÙˆØ¯Ø© (Ù…Ø«Ø§Ù„: 1080p)">
                <input type="text" class="src-link" placeholder="Ø±Ø§Ø¨Ø· ØªÙ„ÙŠØ¬Ø±Ø§Ù… (channel/123)">
                <button class="btn-small" style="background:#dc3545;" onclick="this.parentElement.remove()">X</button>
            `;
            sourcesContainer.appendChild(srcDiv);
        }

        async function saveSeries() {
            const title = document.getElementById('title').value;
            const desc = document.getElementById('desc').value;
            const poster = document.getElementById('poster').value;
            
            // ØªØ¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ù„Ù‚Ø§Øª ÙˆØ§Ù„Ø¬ÙˆØ¯Ø§Øª
            const episodes = [];
            document.querySelectorAll('.episode-block').forEach(epBlock => {
                const epTitle = epBlock.querySelector('.ep-title').value;
                const sources = [];
                epBlock.querySelectorAll('.source-block').forEach(srcBlock => {
                    const quality = srcBlock.querySelector('.src-quality').value;
                    const link = srcBlock.querySelector('.src-link').value;
                    if(quality && link) sources.push({ quality, link });
                });
                if(epTitle && sources.length > 0) episodes.push({ title: epTitle, sources });
            });

            if(!title || episodes.length === 0) {
                alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ù„Ø³Ù„ ÙˆØ­Ù„Ù‚Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ø¨Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø©.");
                return;
            }

            const data = { title, desc, poster, episodes };

            await fetch('/api/series', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            });
            alert('âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­!');
            location.reload();
        }

        // Ø¥Ø¶Ø§ÙØ© Ø­Ù„Ù‚Ø© ÙØ§Ø±ØºØ© Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
        addEpisodeBlock();
    </script>
</body>
</html>